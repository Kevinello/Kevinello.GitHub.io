<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>ä»Redisäº‹åŠ¡åˆ°Redis pipeline | Kevinello</title><meta name="keywords" content="æ•°æ®åº“,Redis,å†…å­˜ç®¡ç†"><meta name="author" content="Kevinello"><meta name="copyright" content="Kevinello"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="å‰è¨€ ç›¸ä¿¡å¯¹å…³ç³»æ€§æ•°æ®åº“æœ‰ä½¿ç”¨ç»éªŒçš„ï¼Œéƒ½å¯¹äº‹åŠ¡æ“ä½œå¾ˆç†Ÿæ‚‰ï¼Œä¸ºäº†ç¡®ä¿è¿ç»­å¤šä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„æ•°æ®åº“éƒ½ä¼šæœ‰äº‹åŠ¡çš„æ”¯æŒï¼ŒRedis ä¹Ÿä¸ä¾‹å¤–ï¼›ä½†å®ƒåˆå’Œå…³ç³»å‹æ•°æ®åº“æ”¯æŒçš„äº‹åŠ¡ä¸å¤ªä¸€æ ·  éœ€è¦äº†è§£çš„å‡ ä¸ªè¯  äº‹åŠ¡ï¼šæ•°æ®åº“äº‹åŠ¡é€šå¸¸åŒ…å«äº†ä¸€ä¸ªåºåˆ—çš„å¯¹æ•°æ®åº“çš„è¯»&#x2F;å†™æ“ä½œã€‚åŒ…å«æœ‰ä»¥ä¸‹ä¸¤ä¸ªç›®çš„ï¼š  ä¸ºæ•°æ®åº“æ“ä½œåºåˆ—æä¾›äº†ä¸€ä¸ªä»å¤±è´¥ä¸­æ¢å¤åˆ°æ­£å¸¸çŠ¶æ€çš„æ–¹æ³•ï¼ŒåŒæ—¶æä¾›äº†æ•°æ®åº“å³ä½¿åœ¨å¼‚å¸¸çŠ¶æ€ä¸‹ä»èƒ½ä¿æŒä¸€è‡´æ€§çš„æ–¹æ³•"><meta property="og:type" content="article"><meta property="og:title" content="ä»Redisäº‹åŠ¡åˆ°Redis pipeline"><meta property="og:url" content="http://kevinello.ltd/2021/04/19/%E4%BB%8ERedis%E4%BA%8B%E5%8A%A1%E5%88%B0Redis-pipeline/index.html"><meta property="og:site_name" content="Kevinello"><meta property="og:description" content="å‰è¨€ ç›¸ä¿¡å¯¹å…³ç³»æ€§æ•°æ®åº“æœ‰ä½¿ç”¨ç»éªŒçš„ï¼Œéƒ½å¯¹äº‹åŠ¡æ“ä½œå¾ˆç†Ÿæ‚‰ï¼Œä¸ºäº†ç¡®ä¿è¿ç»­å¤šä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„æ•°æ®åº“éƒ½ä¼šæœ‰äº‹åŠ¡çš„æ”¯æŒï¼ŒRedis ä¹Ÿä¸ä¾‹å¤–ï¼›ä½†å®ƒåˆå’Œå…³ç³»å‹æ•°æ®åº“æ”¯æŒçš„äº‹åŠ¡ä¸å¤ªä¸€æ ·  éœ€è¦äº†è§£çš„å‡ ä¸ªè¯  äº‹åŠ¡ï¼šæ•°æ®åº“äº‹åŠ¡é€šå¸¸åŒ…å«äº†ä¸€ä¸ªåºåˆ—çš„å¯¹æ•°æ®åº“çš„è¯»&#x2F;å†™æ“ä½œã€‚åŒ…å«æœ‰ä»¥ä¸‹ä¸¤ä¸ªç›®çš„ï¼š  ä¸ºæ•°æ®åº“æ“ä½œåºåˆ—æä¾›äº†ä¸€ä¸ªä»å¤±è´¥ä¸­æ¢å¤åˆ°æ­£å¸¸çŠ¶æ€çš„æ–¹æ³•ï¼ŒåŒæ—¶æä¾›äº†æ•°æ®åº“å³ä½¿åœ¨å¼‚å¸¸çŠ¶æ€ä¸‹ä»èƒ½ä¿æŒä¸€è‡´æ€§çš„æ–¹æ³•"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://kevinello-1302687393.cos.ap-hongkong.myqcloud.com/img/20210406093557.jpg"><meta property="article:published_time" content="2021-04-19T03:15:07.000Z"><meta property="article:modified_time" content="2022-04-09T15:00:30.016Z"><meta property="article:author" content="Kevinello"><meta property="article:tag" content="æ•°æ®åº“"><meta property="article:tag" content="Redis"><meta property="article:tag" content="å†…å­˜ç®¡ç†"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://kevinello-1302687393.cos.ap-hongkong.myqcloud.com/img/20210406093557.jpg"><link rel="shortcut icon" href="/imgs/K.jpg"><link rel="canonical" href="http://kevinello.ltd/2021/04/19/%E4%BB%8ERedis%E4%BA%8B%E5%8A%A1%E5%88%B0Redis-pipeline/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload='this.media="all"'><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?d2a20aecba22b2eaf60183c4831d9a52";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-RV8K5FBVX5"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-RV8K5FBVX5")</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"13UJR6CRNO","apiKey":"456e56f51ec27a1e13d67bef144f6747","indexName":"Kevinello_blog","hits":{"per_page":6},"languages":{"input_placeholder":"æœç´¢æ–‡ç« ","hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼Œç”¨æ—¶ ${time} æ¯«ç§’"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: {"limitDay":180,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"ä»Redisäº‹åŠ¡åˆ°Redis pipeline",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2022-04-09 23:00:30"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/font_2232093_k6128tldgy.css"><meta name="generator" content="Hexo 5.2.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://kevinello-1302687393.file.myqcloud.com/picgo/2022/04/11/myself-e3fde6.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">38</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">84</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">6</div></a></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://kevinello-1302687393.cos.ap-hongkong.myqcloud.com/img/20210406093557.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Kevinello</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ä»Redisäº‹åŠ¡åˆ°Redis pipeline</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2021-04-19T03:15:07.000Z" title="å‘è¡¨äº 2021-04-19 11:15:07">2021-04-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2022-04-09T15:00:30.016Z" title="æ›´æ–°äº 2022-04-09 23:00:30">2022-04-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/">æŠ€æœ¯æ–‡ç« </a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">2.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>10åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="ä»Redisäº‹åŠ¡åˆ°Redis pipeline"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>ç›¸ä¿¡å¯¹å…³ç³»æ€§æ•°æ®åº“æœ‰ä½¿ç”¨ç»éªŒçš„ï¼Œéƒ½å¯¹<strong>äº‹åŠ¡</strong>æ“ä½œå¾ˆç†Ÿæ‚‰ï¼Œä¸ºäº†ç¡®ä¿è¿ç»­å¤šä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„æ•°æ®åº“éƒ½ä¼šæœ‰äº‹åŠ¡çš„æ”¯æŒï¼ŒRedis ä¹Ÿä¸ä¾‹å¤–ï¼›ä½†å®ƒåˆå’Œå…³ç³»å‹æ•°æ®åº“æ”¯æŒçš„<strong>äº‹åŠ¡</strong>ä¸å¤ªä¸€æ ·</p><h2 id="éœ€è¦äº†è§£çš„å‡ ä¸ªè¯"><a class="markdownIt-Anchor" href="#éœ€è¦äº†è§£çš„å‡ ä¸ªè¯"></a> éœ€è¦äº†è§£çš„å‡ ä¸ªè¯</h2><ul><li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1"><strong>äº‹åŠ¡</strong></a>ï¼šæ•°æ®åº“äº‹åŠ¡é€šå¸¸åŒ…å«äº†ä¸€ä¸ªåºåˆ—çš„å¯¹æ•°æ®åº“çš„è¯»/å†™æ“ä½œã€‚åŒ…å«æœ‰ä»¥ä¸‹ä¸¤ä¸ªç›®çš„ï¼š<ol><li>ä¸ºæ•°æ®åº“æ“ä½œåºåˆ—æä¾›äº†ä¸€ä¸ªä»å¤±è´¥ä¸­æ¢å¤åˆ°æ­£å¸¸çŠ¶æ€çš„æ–¹æ³•ï¼ŒåŒæ—¶æä¾›äº†æ•°æ®åº“å³ä½¿åœ¨å¼‚å¸¸çŠ¶æ€ä¸‹ä»èƒ½ä¿æŒä¸€è‡´æ€§çš„æ–¹æ³•</li><li>å½“å¤šä¸ª<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F">åº”ç”¨ç¨‹åº</a>åœ¨<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%B9%B6%E5%8F%91">å¹¶å‘</a>è®¿é—®æ•°æ®åº“æ—¶ï¼Œå¯ä»¥åœ¨è¿™äº›åº”ç”¨ç¨‹åºä¹‹é—´æä¾›ä¸€ä¸ªéš”ç¦»æ–¹æ³•ï¼Œä»¥é˜²æ­¢å½¼æ­¤çš„æ“ä½œäº’ç›¸å¹²æ‰°</li></ol></li><li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1#ACID%E6%80%A7%E8%B4%A8">ACID</a>ï¼šå…³ç³»æ€§æ•°æ®åº“äº‹åŠ¡å…·æœ‰çš„å››ä¸ªç‰¹æ€§ï¼š<strong>åŸå­æ€§ï¼ˆAtomicityï¼‰</strong>ã€<strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong>ã€<strong>éš”ç¦»æ€§ï¼ˆIsolationï¼‰</strong>ã€<strong>æŒä¹…æ€§ï¼ˆDurabilityï¼‰</strong></li><li>æ‚²è§‚é”(Pessimistic Lock)ï¼šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼š block ç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”</li><li>ä¹è§‚é”(Optimistic Lock)ï¼šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·ç­‰æœºåˆ¶ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ã€‚ä¹è§‚é”ç­–ç•¥ï¼šæäº¤ç‰ˆæœ¬å¿…é¡»å¤§äºè®°å½•å½“å‰ç‰ˆæœ¬æ‰èƒ½æ‰§è¡Œæ›´æ–°</li></ul><h2 id="redisäº‹åŠ¡"><a class="markdownIt-Anchor" href="#redisäº‹åŠ¡"></a> Redisäº‹åŠ¡</h2><h3 id="åŸºæœ¬ä½¿ç”¨å½¢å¼"><a class="markdownIt-Anchor" href="#åŸºæœ¬ä½¿ç”¨å½¢å¼"></a> åŸºæœ¬ä½¿ç”¨å½¢å¼</h3><ol><li>MULTIï¼ˆå¼€å¯äº‹åŠ¡ï¼‰</li><li>ä¸€ç³»åˆ—å‘½ä»¤åŠ å…¥é˜Ÿåˆ—</li><li>EXECï¼ˆæ‰§è¡Œäº‹åŠ¡ï¼‰/ DISCARDï¼ˆå–æ¶ˆäº‹åŠ¡ï¼‰</li></ol><p>Redis äº‹åŠ¡å¯ä»¥ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œæœ¬è´¨æ˜¯ä¸€ç»„å‘½ä»¤çš„é›†åˆï¼›ä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ï¼ŒæŒ‰é¡ºåºåœ°ä¸²è¡ŒåŒ–æ‰§è¡Œè€Œä¸ä¼šè¢«å…¶å®ƒå‘½ä»¤æ’å…¥ï¼Œä¸è®¸åŠ å¡</p><p>å¯ä»¥ä¿è¯ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œä¸€æ¬¡æ€§ã€é¡ºåºæ€§ã€æ’ä»–æ€§çš„æ‰§è¡Œä¸€ç³»åˆ—å‘½ä»¤ï¼ˆRedis äº‹åŠ¡çš„ä¸»è¦ä½œç”¨å…¶å®å°±æ˜¯ä¸²è”å¤šä¸ªå‘½ä»¤é˜²æ­¢åˆ«çš„å‘½ä»¤æ’é˜Ÿï¼‰</p><table><thead><tr><th style="text-align:left">å‘½ä»¤</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">MULTI</td><td style="text-align:left">å°†å®¢æˆ·ç«¯çš„ <code>REDIS_MULTI</code> é€‰é¡¹æ‰“å¼€ï¼Œ è®©å®¢æˆ·ç«¯ä»éäº‹åŠ¡çŠ¶æ€åˆ‡æ¢åˆ°äº‹åŠ¡çŠ¶æ€</td></tr><tr><td style="text-align:left">EXEC</td><td style="text-align:left">æ‰§è¡Œæ‰€æœ‰äº‹åŠ¡å—å†…çš„å‘½ä»¤</td></tr><tr><td style="text-align:left">DISCARD</td><td style="text-align:left">å–æ¶ˆäº‹åŠ¡ï¼Œæ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡å—å†…çš„æ‰€æœ‰å‘½ä»¤</td></tr><tr><td style="text-align:left">WATCH</td><td style="text-align:left">ç›‘è§†ä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰keyï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰keyè¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­</td></tr><tr><td style="text-align:left">UNWATCH</td><td style="text-align:left">å–æ¶ˆ WATCH å‘½ä»¤å¯¹æ‰€æœ‰ keys çš„ç›‘è§†</td></tr></tbody></table><p>å¦‚æœæ‰§è¡Œä¸€å¸†é£é¡ºï¼Œåˆ°è¿™é‡Œä¸€åˆ‡éƒ½æ˜¾å¾—é‚£ä¹ˆåˆç†ï¼š</p><p><img src="https://kevinello-1302687393.cos.ap-hongkong.myqcloud.com/img/20210418160029.png" alt=""></p><p><img src="https://kevinello-1302687393.cos.ap-hongkong.myqcloud.com/img/20210418160343.png" alt=""></p><p>ä½†åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­å¾€å¾€è¿˜ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼š</p><ul><li><p>äº‹åŠ¡åœ¨æ‰§è¡Œ <code>EXEC</code> ä¹‹å‰ï¼Œå…¥é˜Ÿçš„å‘½ä»¤å¯èƒ½ä¼šå‡ºé”™ã€‚æ¯”å¦‚è¯´ï¼Œå‘½ä»¤å¯èƒ½ä¼šäº§ç”Ÿè¯­æ³•é”™è¯¯ï¼ˆå‚æ•°æ•°é‡é”™è¯¯ï¼Œå‚æ•°åé”™è¯¯ç­‰ç­‰ï¼Œå¾€å¾€æ˜¯å› ä¸ºè°ƒç”¨è€…æ²¡æœ‰å¯¹å‚æ•°è¿›è¡Œåˆ¤ç©ºå¤„ç†ï¼‰</p></li><li><p>å‘½ä»¤å¯èƒ½åœ¨ <code>EXEC</code> è°ƒç”¨ä¹‹åå¤±è´¥ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œäº‹åŠ¡ä¸­çš„å‘½ä»¤å¯èƒ½å¤„ç†äº†é”™è¯¯ç±»å‹çš„é”®ï¼Œæ¯”å¦‚å°†åˆ—è¡¨å‘½ä»¤ç”¨åœ¨äº†å­—ç¬¦ä¸²é”®ä¸Šé¢</p></li><li><p>OOM / used_memoryè¶…è¿‡è®¾ç½®çš„maxmemoryï¼ˆå›¾ä¸ºredis-server podæŒ‚æ‰äº†ï¼‰</p><p><img src="https://kevinello-1302687393.cos.ap-hongkong.myqcloud.com/img/20210418160803.png" alt=""></p></li></ul><p>Redis é’ˆå¯¹å¦‚ä¸Šä¸¤ç§é”™è¯¯é‡‡ç”¨äº†ä¸åŒçš„å¤„ç†ç­–ç•¥ï¼Œå¯¹äºå‘ç”Ÿåœ¨ <code>EXEC</code> æ‰§è¡Œä¹‹å‰çš„é”™è¯¯ï¼ŒæœåŠ¡å™¨ä¼šå¯¹å‘½ä»¤å…¥é˜Ÿå¤±è´¥çš„æƒ…å†µè¿›è¡Œè®°å½•ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯è°ƒç”¨ <code>EXEC</code> å‘½ä»¤æ—¶ï¼Œæ‹’ç»æ‰§è¡Œå¹¶è‡ªåŠ¨æ”¾å¼ƒè¿™ä¸ªäº‹åŠ¡ï¼ˆRedis 2.6.5 ä¹‹å‰çš„åšæ³•æ˜¯æ£€æŸ¥å‘½ä»¤å…¥é˜Ÿæ‰€å¾—çš„è¿”å›å€¼ï¼šå¦‚æœå‘½ä»¤å…¥é˜Ÿæ—¶è¿”å› <code>QUEUED</code> ï¼Œé‚£ä¹ˆå…¥é˜ŸæˆåŠŸï¼›å¦åˆ™ï¼Œå°±æ˜¯å…¥é˜Ÿå¤±è´¥ï¼‰</p><p><img src="https://kevinello-1302687393.cos.ap-hongkong.myqcloud.com/img/20210418161319.png" alt=""></p><p>å¦‚ä¸Šå›¾ï¼Œ<code>EXEC</code>å‰å‘½ä»¤å…¥é˜Ÿæ—¶å‡ºç°äº†è¯­æ³•é”™è¯¯ï¼Œ<code>EXEC</code>æ—¶åˆ™ä¼šç›´æ¥æ‹’ç»è¯¥äº‹åŠ¡</p><p>å¯¹äºé‚£äº›åœ¨ <code>EXEC</code> å‘½ä»¤æ‰§è¡Œä¹‹åæ‰€äº§ç”Ÿçš„é”™è¯¯ï¼Œ å¹¶æ²¡æœ‰å¯¹å®ƒä»¬è¿›è¡Œç‰¹åˆ«å¤„ç†ï¼š å³ä½¿äº‹åŠ¡ä¸­æœ‰æŸä¸ª/æŸäº›å‘½ä»¤åœ¨æ‰§è¡Œæ—¶äº§ç”Ÿäº†é”™è¯¯ï¼Œ äº‹åŠ¡ä¸­çš„å…¶ä»–å‘½ä»¤ä»ç„¶ä¼šç»§ç»­æ‰§è¡Œ</p><p><img src="https://kevinello-1302687393.cos.ap-hongkong.myqcloud.com/img/20210418161447.png" alt=""></p><p>å¦‚ä¸Šå›¾ï¼Œ<code>INCRBY kevinello 1</code>è¯­æ³•æ²¡æœ‰é”™è¯¯ï¼Œä½†<code>kevinello</code>çš„<code>value</code>æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä¸èƒ½å¯¹å…¶ä½¿ç”¨<code>INCRBY</code>ï¼›è¿™ç§æƒ…å†µæ‰§è¡Œ<code>EXEC</code>ä¸ä¼šæŠ¥é”™ï¼Œåªæœ‰é‚£ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥</p><p>ä¹Ÿå°±æ˜¯è¯´<code>Redis</code>æ˜¯ä¸æ”¯æŒå›æ»šçš„</p><h2 id="ä¸ºä»€ä¹ˆ-redis-ä¸æ”¯æŒå›æ»š"><a class="markdownIt-Anchor" href="#ä¸ºä»€ä¹ˆ-redis-ä¸æ”¯æŒå›æ»š"></a> ä¸ºä»€ä¹ˆ Redis ä¸æ”¯æŒå›æ»š</h2><p><a target="_blank" rel="noopener" href="https://redislabs.com/blog/you-dont-need-transaction-rollbacks-in-redis/">ä»¥ä¸‹æ˜¯å®˜æ–¹çš„è§£é‡Š</a>ï¼š</p><blockquote><p>This is the moment where one might say that rollbacks would be nice to have. I might agree if not for two considerations:</p><ol><li>The snapshotting mechanism required to implement rollbacks would have a considerable computational cost. That extra complexity wouldnâ€™t sit well with Redisâ€™ philosophy and ecosystem.</li><li>Rollbacks canâ€™t catch all errors. In the example above, we set â€œcounterâ€ to â€œbananaâ€ in order to show a blatant error, but in the real world the process that used the â€œcounterâ€ key in the wrong way might instead have deleted it, or put in a credit-card number, for example. Rollbacks would add a considerable amount of complexity and would still not fully solve the problem.</li></ol><p>The second point is particularly important because it also applies to SQL: SQL DBMSs offer many mechanisms to help protect data integrity, but even they canâ€™t completely protect you from programming errors. <strong>On both platforms, the burden of writing correct transactions remains on you.</strong></p></blockquote><p>ç¿»è¯‘ä¸€ä¸‹ï¼Œä¸¤å¥è¯ï¼š</p><blockquote><ol><li>å›æ»šæ˜¯éå¸¸å¤æ‚çš„æ“ä½œï¼Œä¸ç¬¦åˆRedisçš„è®¾è®¡å“²å­¦å’Œç”Ÿæ€ç³»ç»Ÿï¼Œä¸”å›æ»šä¹Ÿä¸èƒ½è§£å†³æ‰€æœ‰é—®é¢˜</li><li>éœ€è¦å›æ»šå®Œå…¨æ˜¯ä½ ä»¬çš„ç¼–ç¨‹é”™è¯¯å¯¼è‡´çš„ï¼Œè¿™äº›é”™è¯¯åº”è¯¥åœ¨å¼€å‘æ—¶å°±è¢«å‘ç°ï¼Œæˆ‘Redisä¸èƒŒè¿™é”…ï¼›é‰´äºæ²¡æœ‰ä»»ä½•æœºåˆ¶èƒ½é¿å…ç¨‹åºå‘˜è‡ªå·±é€ æˆçš„é”™è¯¯ï¼Œ å¹¶ä¸”è¿™ç±»é”™è¯¯é€šå¸¸ä¸ä¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å‡ºç°ï¼Œ æ‰€ä»¥ Redis é€‰æ‹©äº†æ›´ç®€å•ã€æ›´å¿«é€Ÿçš„æ— å›æ»šæ–¹å¼æ¥å¤„ç†äº‹åŠ¡</li></ol></blockquote><p>å…¶å®è¿™ç¯‡è§£é‡Šå¾ˆæœ‰æ„æ€ï¼Œå…¶ä¸­ä¹Ÿå¤šæ¬¡æåˆ°äº†<code>Redis</code>çš„è®¾è®¡å“²å­¦ä»¥åŠä¸<code>SQL</code>çš„å¯¹æ¯”ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è¯¦ç»†é˜…è¯»ï¼ˆçœ‹åˆ«äººæ’•é€¼çœŸæœ‰è¶£ï¼‰</p><h2 id="åŸºäºwatchçš„äº‹åŠ¡"><a class="markdownIt-Anchor" href="#åŸºäºwatchçš„äº‹åŠ¡"></a> åŸºäºWATCHçš„äº‹åŠ¡</h2><blockquote><p>how do you create a transaction that depends on the data present in Redis? For this purpose, Redis implements WATCH, a command for performing optimistic locking.</p><p>å¦‚ä½•åˆ›å»ºä¸€ä¸ªä¾èµ–äºRedisä¸­å·²å­˜åœ¨çš„æ•°æ®çš„äº‹åŠ¡ï¼Ÿ ä¸ºæ­¤ï¼ŒRediså®ç°äº†WATCHï¼Œè¿™æ˜¯ç”¨äºæ‰§è¡Œä¹è§‚é”çš„å‘½ä»¤</p></blockquote><h3 id="rediså®ç°çš„ä¹è§‚é”"><a class="markdownIt-Anchor" href="#rediså®ç°çš„ä¹è§‚é”"></a> Rediså®ç°çš„ä¹è§‚é”</h3><p><code>WATCH</code> å‘½ä»¤ç”¨äºåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰ç›‘è§†ä»»æ„æ•°é‡çš„é”®ï¼š å½“è°ƒç”¨ <code>EXEC</code> å‘½ä»¤æ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œ å¦‚æœä»»æ„ä¸€ä¸ªè¢«ç›‘è§†çš„é”®å·²ç»è¢«å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹äº†ï¼Œ é‚£ä¹ˆæ•´ä¸ªäº‹åŠ¡å°†è¢«æ‰“æ–­ï¼Œä¸å†æ‰§è¡Œï¼Œ ç›´æ¥è¿”å›å¤±è´¥</p><p><code>WATCH</code>å‘½ä»¤å¯ä»¥è¢«è°ƒç”¨å¤šæ¬¡ï¼› å¯¹é”®çš„ç›‘è§†ä» <code>WATCH</code> æ‰§è¡Œä¹‹åå¼€å§‹ç”Ÿæ•ˆï¼Œ ç›´åˆ°è°ƒç”¨ <code>EXEC</code>ä¸ºæ­¢</p><p>å½“å¤šä¸ª<code>Redis</code>å®¢æˆ·ç«¯å°è¯•ä½¿ç”¨äº‹åŠ¡æ”¹åŠ¨åŒä¸€ä¸ªè¢«<code>WATCH</code>ç›‘è§†çš„é”®æ—¶ï¼Œ<code>Redis</code>ä¼šè‡ªåŠ¨æŠ›å¼ƒæŸäº›äº‹åŠ¡ï¼Œè¿™æ—¶å®¢æˆ·ç«¯éœ€è¦é‡è¯•è¯¥äº‹åŠ¡</p><p><code>WATCH</code>çš„å®ç°æ˜¯åŸºäº<code>redis</code>ä¸­ä¿å­˜çš„<code>watched_keys</code> å­—å…¸å®ç°çš„ï¼Œå­—å…¸çš„é”®æ˜¯è¿™ä¸ªæ•°æ®åº“è¢«ç›‘è§†çš„é”®ï¼Œ è€Œå­—å…¸çš„å€¼åˆ™æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œ é“¾è¡¨ä¸­ä¿å­˜äº†æ‰€æœ‰ç›‘è§†è¿™ä¸ªé”®çš„å®¢æˆ·ç«¯</p><p>å…·ä½“å®ç°è§<a target="_blank" rel="noopener" href="https://redisbook.readthedocs.io/en/latest/feature/transaction.html?spm=a2c6h.12873639.0.0.59911280BIyHp7#id3">å®˜æ–¹æ–‡æ¡£</a></p><h2 id="pipeline"><a class="markdownIt-Anchor" href="#pipeline"></a> Pipeline</h2><blockquote><p>Another way to reduce the latency of Redis queries is by using <a target="_blank" rel="noopener" href="http://redis.io/topics/pipelining">pipelining</a>. When you pipeline a group of operations, they are sent in a single batch that, while bigger and slower to process, requires only a single request-response round trip. This consolidation of trips makes for substantial overall latency reductions.</p></blockquote><p><code>Redis</code>äº‹åŠ¡åœ¨å‘é€æ¯ä¸ªæŒ‡ä»¤åˆ°äº‹åŠ¡ç¼“å­˜é˜Ÿåˆ—æ—¶éƒ½è¦ç»è¿‡ä¸€æ¬¡ç½‘ç»œè¯»å†™ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æŒ‡ä»¤è¾ƒå¤šæ—¶ï¼Œéœ€è¦çš„ç½‘ç»œ IO æ—¶é—´ä¹Ÿä¼šçº¿æ€§å¢é•¿ã€‚æ‰€ä»¥é€šå¸¸ <code>Redis</code>çš„å®¢æˆ·ç«¯åœ¨æ‰§è¡Œäº‹åŠ¡æ—¶éƒ½ä¼šç»“åˆ <code>pipeline</code>ä¸€èµ·ä½¿ç”¨ï¼Œè¿™æ ·å¯ä»¥å°†å¤šæ¬¡ IO æ“ä½œå‹ç¼©ä¸ºå•æ¬¡ IO æ“ä½œ</p><p>è¿™é‡ŒåŸºäº<code>go-redis</code>å®¢æˆ·ç«¯å®ç°çš„<code>pipeline</code>èŠä¸€ä¸‹<code>pipeline</code>çš„ä½¿ç”¨</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TxPipeline acts like Pipeline, but wraps queued commands with MULTI/EXEC.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Client)</span> <span class="title">TxPipeline</span><span class="params">()</span> *<span class="title">Pipeline</span></span> &#123;</span><br><span class="line">	pipe := Pipeline&#123;</span><br><span class="line">		exec: c.pipelineExecer(c.txPipelineProcessCmds),</span><br><span class="line">	&#125;</span><br><span class="line">	pipe.cmdable.process = pipe.Process</span><br><span class="line">	pipe.statefulCmdable.process = pipe.Process</span><br><span class="line">	<span class="keyword">return</span> &amp;pipe</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯<code>go-redis</code>ä¸­å®ç°çš„äº‹åŠ¡<code>pipeline</code>ï¼Œä¸æ™®é€š<code>pipeline</code>ä¸åŒçš„åœ°æ–¹ä»…åœ¨äºå®ƒçš„<code>Exec</code>æ–¹æ³•ï¼Œ<code>txPipelineProcessCmds</code>ä¸­è°ƒç”¨äº†<code>txPipelineWriteMulti</code>:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">txPipelineWriteMulti</span><span class="params">(cn *pool.Conn, cmds []Cmder)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	multiExec := <span class="built_in">make</span>([]Cmder, <span class="number">0</span>, <span class="built_in">len</span>(cmds)+<span class="number">2</span>)</span><br><span class="line">	multiExec = <span class="built_in">append</span>(multiExec, NewStatusCmd(<span class="string">&quot;MULTI&quot;</span>))</span><br><span class="line">	multiExec = <span class="built_in">append</span>(multiExec, cmds...)</span><br><span class="line">	multiExec = <span class="built_in">append</span>(multiExec, NewSliceCmd(<span class="string">&quot;EXEC&quot;</span>))</span><br><span class="line">	<span class="keyword">return</span> writeCmd(cn, multiExec...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>TxPipeline</code>åªæ˜¯åšäº†ä¸€ä¸‹åŒ…è£…ä½¿å…¶æ”¯æŒäº‹åŠ¡</p><h2 id="pipelineçš„è¿›é˜¶ä½¿ç”¨"><a class="markdownIt-Anchor" href="#pipelineçš„è¿›é˜¶ä½¿ç”¨"></a> pipelineçš„è¿›é˜¶ä½¿ç”¨</h2><p><code>pipeline</code>çš„åŸºæœ¬ä½¿ç”¨éå¸¸ç®€å•ï¼Œä½†æœ‰<a target="_blank" rel="noopener" href="https://redislabs.com/blog/redis-running-slowly-heres-what-you-can-do-about-it/">å‡ ç‚¹è¦æ³¨æ„</a>ï¼š</p><blockquote><p>Note, however, that a pipeline operation could block your application if it is waiting for replies without sending the pipeline â€“ Redis will provide all of the replies to the pipelined stream of commands only after the pipeline has been sent. Also bear in mind that when using pipelining, Redis caches all the responses in memory before returning them to the client in bulk, so pipelining thousands of queries (especially those that return a large amount of data) can be taxing to both the server and client. If that is the case, use smaller pipeline sizes.</p></blockquote><ul><li>ä¸€ä¸ª<code>pipeline</code>åŒ…å«çš„å‘½ä»¤ä¸åº”å¤ªå¤šï¼Œå› ä¸ºåœ¨ä½¿ç”¨æµæ°´çº¿æ“ä½œæ—¶ï¼Œ<code>Redis</code>åœ¨å°†æ‰€æœ‰å“åº”æ‰¹é‡è¿”å›ç»™å®¢æˆ·ç«¯ä¹‹å‰ä¼š<strong>å°†æ‰€æœ‰å“åº”ç¼“å­˜åœ¨å†…å­˜</strong>ä¸­ï¼Œå› æ­¤å¯¹æ•°åƒä¸ªæŸ¥è¯¢ï¼ˆç‰¹åˆ«æ˜¯é‚£äº›è¿”å›å¤§é‡æ•°æ®çš„æŸ¥è¯¢ï¼‰è¿›è¡Œæµæ°´çº¿æ“ä½œå¯èƒ½ä¼šå¯¹æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½é€ æˆè´Ÿæ‹…</li><li>å› ä¸ºå³ä½¿æ˜¯<code>TxPipeline</code>ä¹Ÿåªæ˜¯å¼±äº‹åŠ¡æ€§çš„ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨è®¾è®¡ä¸šåŠ¡æ¨¡å‹æ—¶å°½å¯èƒ½ä¿è¯æ•°æ®å®‰å…¨æ€§ï¼Œé™ä½äº‹åŠ¡å‡ºé”™å¸¦æ¥çš„å½±å“ï¼ˆä¸è¦æŠŠè‡ªå·±å¸¦å…¥åŸºäºSQLçš„è®¾è®¡æ€ç»´ï¼‰</li></ul><p>å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜æˆ‘ä»¬å¯ä»¥ç®€å•å°è£…ä¸€ä¸‹<code>TxPipeline</code>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> MaxPipeLineCmdCount = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyPipeline <span class="keyword">struct</span> &#123;</span><br><span class="line">	Pipeline *redis.Pipeline</span><br><span class="line">	CmdCount <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(myPipeline *MyPipeline)</span> <span class="title">IncrCmdCount</span><span class="params">()</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">	myPipeline.CmdCount++</span><br><span class="line">	<span class="keyword">if</span> myPipeline.CmdCount &gt;= MaxPipeLineCmdCount &#123;</span><br><span class="line">		kutil.Logger.Infof(<span class="string">&quot;myPipeline has %d cmds, will do exec and reset&quot;</span>, MaxPipeLineCmdCount)</span><br><span class="line">		_, err = myPipeline.Pipeline.Exec()</span><br><span class="line">		myPipeline.CmdCount = <span class="number">0</span></span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(myPipeline *MyPipeline)</span> <span class="title">ClearLeftCmds</span><span class="params">()</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> myPipeline.CmdCount &gt; <span class="number">0</span> &#123;</span><br><span class="line">		kutil.Logger.Infof(<span class="string">&quot;myPipeline has %d cmds left, will do exec&quot;</span>, myPipeline.CmdCount)</span><br><span class="line">		_, err = myPipeline.Pipeline.Exec()</span><br><span class="line">		myPipeline.CmdCount = <span class="number">0</span></span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		kutil.Logger.Infof(<span class="string">&quot;myPipeline has no cmds left&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥é‡‡ç”¨å®šæ—¶ä»»åŠ¡çš„æ–¹å¼æ£€æŸ¥<code>cmd</code>ä¸ªæ•°æäº¤<code>pipeline</code></p><h2 id="txpipelineä¸luaè„šæœ¬çš„é€‰æ‹©"><a class="markdownIt-Anchor" href="#txpipelineä¸luaè„šæœ¬çš„é€‰æ‹©"></a> TxPipelineä¸Luaè„šæœ¬çš„é€‰æ‹©</h2><p>å®˜æ–¹è§£é‡Šï¼š</p><blockquote><p>There are, in my opinion, a couple of reasonable situations where you might legitimately prefer transactions with optimistic locking over Lua:</p><ol><li>The keys your transaction depends on are not modified frequently, meaning that you are confident optimistic locking will almost never abort transactions.</li><li>You depend on a lot of logic written on the client sideâ€”or maybe a third-party serviceâ€”so there is no easy way to move that logic to a Lua script.</li></ol><p>Unless both these points are true for your application, I recommend you choose Lua over WATCH</p></blockquote><p>å€¼å¾—æ³¨æ„çš„æ˜¯å®˜æ–¹å¯¹æ¯”çš„æ˜¯å¸¦<code>WATCH</code>çš„äº‹åŠ¡ä¸Luaè„šæœ¬</p><p>ç¿»è¯‘ä¸€ä¸‹</p><p>åªæœ‰ä¸¤ç§åœºæ™¯ä¸‹åº”è¯¥ä½¿ç”¨å¸¦<code>WATCH</code>çš„äº‹åŠ¡è€Œä¸æ˜¯<code>Lua</code>è„šæœ¬ï¼š</p><ul><li>äº‹åŠ¡ä¾èµ–çš„æ•°æ®å¹¶ä¸ä¼šè¢«é¢‘ç¹æ›´æ”¹ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æœ‰ä¿¡å¿ƒ<code>WATCH</code>é”åŸºæœ¬ä¸ä¼šè¢«æ‰“ç ´</li><li>å®¢æˆ·ç«¯çš„ä¸šåŠ¡é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œå°†å…¶å†™æˆ<code>Lua</code>è„šæœ¬çš„æˆæœ¬è¾ƒå¤§</li></ul><h2 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h2><p><code>Redis</code>äº‹åŠ¡ä»…å…·æœ‰ä¸€è‡´æ€§ä¸éš”ç¦»æ€§ï¼Œä¸ä¿è¯åŸå­æ€§å’ŒæŒä¹…æ€§ï¼Œæ‰€ä»¥åœ¨è®¾è®¡ä½¿ç”¨<code>Redis</code>çš„ä¸šåŠ¡æ—¶éœ€è¦ä¿è¯æ•°æ®å®‰å…¨æ€§ï¼Œåœ¨<code>pipeline</code>ä¸<code>Lua</code>è„šæœ¬çš„å–èˆä¸Šå…¶å®ä¹Ÿä¸ç”¨å¤ªè¿‡çº ç»“ï¼Œç®€å•çš„ä¸šåŠ¡å¯ä»¥ç›´æ¥å°è£…æˆ<code>Lua</code>è„šæœ¬</p><p>åœ¨ä½¿ç”¨<code>pipeline</code>æ—¶éœ€è¦æ³¨æ„ç›‘æ§å…¶å‘½ä»¤ä¸ªæ•°ï¼Œé¿å…å¯¹æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é€ æˆè¿‡å¤§çš„è´Ÿæ‹…ï¼Œå¯¼è‡´ä¸šåŠ¡å»¶è¿Ÿä¹ƒè‡³äº<code>OOM</code></p><h2 id="å‚è€ƒæ–‡ç« "><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡ç« "></a> å‚è€ƒæ–‡ç« </h2><ul><li><p><a target="_blank" rel="noopener" href="https://redislabs.com/blog/you-dont-need-transaction-rollbacks-in-redis/">You Donâ€™t Need Transaction Rollbacks in Redis</a></p></li><li><p><a target="_blank" rel="noopener" href="https://redislabs.com/blog/redis-running-slowly-heres-what-you-can-do-about-it/">Redis Running Slowly? Hereâ€™s What You Can Do About it</a></p></li></ul></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…:</span> <span class="post-copyright-info"><a href="mailto:undefined">Kevinello</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥:</span> <span class="post-copyright-info"><a href="http://kevinello.ltd/2021/04/19/%E4%BB%8ERedis%E4%BA%8B%E5%8A%A1%E5%88%B0Redis-pipeline/">http://kevinello.ltd/2021/04/19/ä»Redisäº‹åŠ¡åˆ°Redis-pipeline/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜:</span> <span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://kevinello.ltd" target="_blank">Kevinello</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a><a class="post-meta__tags" href="/tags/Redis/">Redis</a><a class="post-meta__tags" href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/">å†…å­˜ç®¡ç†</a></div><div class="post_share"><div class="social-share" data-image="https://kevinello-1302687393.cos.ap-hongkong.myqcloud.com/img/20210406093557.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/06/14/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%AE%9E%E7%8E%B0/"><img class="prev-cover" src="https://kevinello-1302687393.cos.ap-hongkong.myqcloud.com/img/20210508140417.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Redisåˆ†å¸ƒå¼é”çš„åŸºæœ¬å®ç°</div></div></a></div><div class="next-post pull-right"><a href="/2021/04/11/Redis%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87%E7%9A%84%E4%BA%A7%E7%94%9F%E4%B8%8E%E6%B8%85%E7%90%86/"><img class="next-cover" src="https://kevinello-1302687393.cos.ap-hongkong.myqcloud.com/img/20210411164926.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Rediså†…å­˜ç¢ç‰‡çš„äº§ç”Ÿä¸æ¸…ç†</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2021/04/11/Redis%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87%E7%9A%84%E4%BA%A7%E7%94%9F%E4%B8%8E%E6%B8%85%E7%90%86/" title="Rediså†…å­˜ç¢ç‰‡çš„äº§ç”Ÿä¸æ¸…ç†"><img class="cover" src="https://kevinello-1302687393.cos.ap-hongkong.myqcloud.com/img/20210411164926.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-11</div><div class="title">Rediså†…å­˜ç¢ç‰‡çš„äº§ç”Ÿä¸æ¸…ç†</div></div></a></div><div><a href="/2021/06/14/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%AE%9E%E7%8E%B0/" title="Redisåˆ†å¸ƒå¼é”çš„åŸºæœ¬å®ç°"><img class="cover" src="https://kevinello-1302687393.cos.ap-hongkong.myqcloud.com/img/20210508140417.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-14</div><div class="title">Redisåˆ†å¸ƒå¼é”çš„åŸºæœ¬å®ç°</div></div></a></div><div><a href="/2021/02/06/Redis%E7%9A%84%E8%BF%87%E6%9C%9F%E7%AD%96%E7%95%A5-%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5/" title="Redisçš„è¿‡æœŸç­–ç•¥&å†…å­˜æ·˜æ±°ç­–ç•¥"><img class="cover" src="https://kevinello-1302687393.cos.ap-hongkong.myqcloud.com/img/street2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-06</div><div class="title">Redisçš„è¿‡æœŸç­–ç•¥&å†…å­˜æ·˜æ±°ç­–ç•¥</div></div></a></div><div><a href="/2022/01/10/%E9%9D%A2%E8%AF%95%E5%AE%98%E5%88%9D%E4%BD%93%E9%AA%8C/" title="é¢è¯•å®˜åˆä½“éªŒ"><img class="cover" src="https://kevinello-1302687393.cos.ap-hongkong.myqcloud.com/img/20220110130328.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-10</div><div class="title">é¢è¯•å®˜åˆä½“éªŒ</div></div></a></div><div><a href="/2020/11/29/DEM%E9%A1%B9%E7%9B%AE%E6%97%A5%E5%BF%97/" title="DEMé¡¹ç›®æ—¥å¿—"><img class="cover" src="https://kevinello-1302687393.cos.ap-hongkong.myqcloud.com/img/sky5.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-29</div><div class="title">DEMé¡¹ç›®æ—¥å¿—</div></div></a></div><div><a href="/2020/12/25/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%93%E5%AD%98%E7%9A%84%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="æ•°æ®åº“ç¼“å­˜çš„å¸¸ç”¨è®¾è®¡æ¨¡å¼"><img class="cover" src="https://kevinello-1302687393.cos.ap-hongkong.myqcloud.com/img/high_floor.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-25</div><div class="title">æ•°æ®åº“ç¼“å­˜çš„å¸¸ç”¨è®¾è®¡æ¨¡å¼</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>è¯„è®º</span></div><div id="comment-switch"><span class="first-comment">Utterances</span><span class="switch-btn"></span><span class="second-comment">Twikoo</span></div></div><div class="comment-wrap"><div><div id="utterances-wrap"></div></div><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://kevinello-1302687393.file.myqcloud.com/picgo/2022/04/11/myself-e3fde6.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">Kevinello</div><div class="author-info__description"></div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">38</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">84</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">6</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/kevinello"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/kevinello" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://space.bilibili.com/23149976" target="_blank" title="Bilibili"><i class="iconfont icon-bilibili-fill"></i></a><a class="social-icon" href="mailto:kevinello42@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E8%A6%81%E4%BA%86%E8%A7%A3%E7%9A%84%E5%87%A0%E4%B8%AA%E8%AF%8D"><span class="toc-number">2.</span> <span class="toc-text">éœ€è¦äº†è§£çš„å‡ ä¸ªè¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis%E4%BA%8B%E5%8A%A1"><span class="toc-number">3.</span> <span class="toc-text">Redisäº‹åŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%BD%A2%E5%BC%8F"><span class="toc-number">3.1.</span> <span class="toc-text">åŸºæœ¬ä½¿ç”¨å½¢å¼</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-redis-%E4%B8%8D%E6%94%AF%E6%8C%81%E5%9B%9E%E6%BB%9A"><span class="toc-number">4.</span> <span class="toc-text">ä¸ºä»€ä¹ˆ Redis ä¸æ”¯æŒå›æ»š</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8Ewatch%E7%9A%84%E4%BA%8B%E5%8A%A1"><span class="toc-number">5.</span> <span class="toc-text">åŸºäºWATCHçš„äº‹åŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#redis%E5%AE%9E%E7%8E%B0%E7%9A%84%E4%B9%90%E8%A7%82%E9%94%81"><span class="toc-number">5.1.</span> <span class="toc-text">Rediså®ç°çš„ä¹è§‚é”</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pipeline"><span class="toc-number">6.</span> <span class="toc-text">Pipeline</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pipeline%E7%9A%84%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8"><span class="toc-number">7.</span> <span class="toc-text">pipelineçš„è¿›é˜¶ä½¿ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#txpipeline%E4%B8%8Elua%E8%84%9A%E6%9C%AC%E7%9A%84%E9%80%89%E6%8B%A9"><span class="toc-number">8.</span> <span class="toc-text">TxPipelineä¸Luaè„šæœ¬çš„é€‰æ‹©</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">9.</span> <span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">10.</span> <span class="toc-text">å‚è€ƒæ–‡ç« </span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/10/16/Golang-optimization%E3%80%8C0%E3%80%8D-%E5%BA%8F%E7%AB%A0/" title="Golang-optimizationã€Œ0ã€: åºç« "><img src="https://kevinello-1302687393.file.myqcloud.com/picgo/2022/10/16/Screenshot-from-2022-06-23-01-35-59-1170x694-afe109.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Golang-optimizationã€Œ0ã€: åºç« "></a><div class="content"><a class="title" href="/2022/10/16/Golang-optimization%E3%80%8C0%E3%80%8D-%E5%BA%8F%E7%AB%A0/" title="Golang-optimizationã€Œ0ã€: åºç« ">Golang-optimizationã€Œ0ã€: åºç« </a><time datetime="2022-10-16T07:34:11.000Z" title="å‘è¡¨äº 2022-10-16 15:34:11">2022-10-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/07/Git-%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8-1/" title="Git è¿›é˜¶ä½¿ç”¨1"><img src="https://kevinello-1302687393.file.myqcloud.com/picgo/2022/10/08/baby-git-release-6ede8f.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Git è¿›é˜¶ä½¿ç”¨1"></a><div class="content"><a class="title" href="/2022/10/07/Git-%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8-1/" title="Git è¿›é˜¶ä½¿ç”¨1">Git è¿›é˜¶ä½¿ç”¨1</a><time datetime="2022-10-07T09:00:36.000Z" title="å‘è¡¨äº 2022-10-07 17:00:36">2022-10-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/10/notion-%E5%88%9D%E6%AD%A5%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/" title="notion åˆæ­¥ä½¿ç”¨æŒ‡å—"><img src="https://kevinello-1302687393.file.myqcloud.com/picgo/2022/08/28/Notion_app_logo-64956b.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="notion åˆæ­¥ä½¿ç”¨æŒ‡å—"></a><div class="content"><a class="title" href="/2022/08/10/notion-%E5%88%9D%E6%AD%A5%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/" title="notion åˆæ­¥ä½¿ç”¨æŒ‡å—">notion åˆæ­¥ä½¿ç”¨æŒ‡å—</a><time datetime="2022-08-09T17:49:07.000Z" title="å‘è¡¨äº 2022-08-10 01:49:07">2022-08-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/01/%E5%A4%A7%E4%B8%80%E7%BB%9F%E7%AC%A6%E5%8F%B7%E8%BF%98%E5%8E%9F/" title="å¤§ä¸€ç»Ÿç¬¦å·è¿˜åŸ"><img src="https://kevinello-1302687393.file.myqcloud.com/picgo/2022/08/03/image-20220803133758954-65fb61.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="å¤§ä¸€ç»Ÿç¬¦å·è¿˜åŸ"></a><div class="content"><a class="title" href="/2022/08/01/%E5%A4%A7%E4%B8%80%E7%BB%9F%E7%AC%A6%E5%8F%B7%E8%BF%98%E5%8E%9F/" title="å¤§ä¸€ç»Ÿç¬¦å·è¿˜åŸ">å¤§ä¸€ç»Ÿç¬¦å·è¿˜åŸ</a><time datetime="2022-08-01T06:11:30.000Z" title="å‘è¡¨äº 2022-08-01 14:11:30">2022-08-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/17/%E6%B5%85%E8%B0%88%E6%B5%81%E7%A8%8B-in-2022/" title="æµ…è°ˆæµç¨‹ in 2022"><img src="http://kevinello-1302687393.file.myqcloud.com/picgo/2022/07/17/755134-27e050.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="æµ…è°ˆæµç¨‹ in 2022"></a><div class="content"><a class="title" href="/2022/07/17/%E6%B5%85%E8%B0%88%E6%B5%81%E7%A8%8B-in-2022/" title="æµ…è°ˆæµç¨‹ in 2022">æµ…è°ˆæµç¨‹ in 2022</a><time datetime="2022-07-17T02:08:17.000Z" title="å‘è¡¨äº 2022-07-17 10:08:17">2022-07-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(https://kevinello-1302687393.cos.ap-hongkong.myqcloud.com/img/20210406093557.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Kevinello</div><div class="framework-info"><span>æ¡†æ¶</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">ğŸ¥³ ğŸ¥³ ğŸ¥³ ğŸ¥³ ğŸ¥³</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Algolia</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script><script src="/js/search/optimized_algolia.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script><script>function loadUtterances () {
  let ele = document.createElement('script')
  ele.setAttribute('id', 'utterances_comment')
  ele.setAttribute('src', 'https://utteranc.es/client.js')
  ele.setAttribute('repo', 'Kevinello/gitalk')
  ele.setAttribute('issue-term', 'pathname')
  let nowTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'photon-dark' : 'github-light'
  ele.setAttribute('theme', nowTheme)
  ele.setAttribute('crossorigin', 'anonymous')
  ele.setAttribute('async', 'true')
  document.getElementById('utterances-wrap').insertAdjacentElement('afterbegin',ele)
}

function utterancesTheme () {
  const iframe = document.querySelector('.utterances-frame')
  if (iframe) {
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'photon-dark' : 'github-light'
    const message = {
      type: 'set-theme',
      theme: theme
    };
    iframe.contentWindow.postMessage(message, 'https://utteranc.es');
  }
}

if ('Utterances' === 'Utterances' || !false) {
  if (false) btf.loadComment(document.getElementById('utterances-wrap'), loadUtterances)
  else loadUtterances()
} else {
  function loadOtherComment () {
    loadUtterances()
  }
}</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'blog-comments-9gil6as164013b6c',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.vemoji)'))
      }
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'blog-comments-9gil6as164013b6c',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      document.getElementById('twikoo-count').innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Utterances' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script async data-pjax src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>